# Redis事务
* 事务是指一系列操作步骤，这一系列的操作步骤，要么完全地执行，要么完全地不执行
* Redis中的事务（transaction）是一组命令的集合，至少是两个或两个以上的命令，redis事务保证这些命令被执行时中间不会被任何其他操作打断
### 事务操作命令
1. multi
    * 语法：multi
    * 作用：标记一个事务的开始，事务内的多条命令会按照先后顺序被放进一个队列当中
    * 返回值：总是返回OK
2. exec
    * 语法：exec
    * 作用：执行所有事务块内的命令
    * 返回值：事务内的所有执行语句内容，事务被打断（影响）返回 nil
3. discard
    * 语法：discard
    * 作用：取消事务，放弃执行事务块内的所有命令
    * 返回值：总是返回OK
4. watch
    * 语法：watch key [key ...]
    * 作用：监视一个(或多个) key，如果在事务执行之前这个(或这些)key被其他命令所改动，那么事务将被打断。
    * 返回值：总是返回OK
5. unwatch
    * 语法：unwatch
    * 作用：取消WATCH命令对所有key的监视。如果在执行WATCH命令之后，EXEC命令或DISCARD命令先被执行了的话，那么就不需要再执行UNWATCH
    * 返回值：总是返回OK
### 事务的实现
1. 正常执行事务
    * multi：用multi命令告诉Redis，接下来要执行的命令你先不要执行，而是把它们暂时存起来（开启事务）
    * "sadd works john"第一条命令进入等待队列（命令入队）；"sadd works rose"第二条命令进入等待队列（命令入队）
    * 返回 QUEUED表示命令进入队列，等待执行
    * exce：告知redis执行前面发送的两条命令（提交事务）
```
127.0.0.1:6379> multi
OK
127.0.0.1:6379> sadd works john
QUEUED
127.0.0.1:6379> sadd works rose
QUEUED
127.0.0.1:6379> exce
1) (integer) 1
2) (integer) 1
```
2. 命令错误导致事务执行失败
    * 在执行exec之前，命令本身语法错误，事务终止，不会执行
    * 在执行exec之后，命令在执行的过程中，出现错误，事务正常提交，不会影响正确的命令执行
### Redis的watch机制
* WATCH机制原理：使用WATCH监视一个或多个key，跟踪key的value修改情况，如果有key的value值在事务EXEC执行之前被修改了，整个事务被取消；EXEC返回提示信息，表 示事务已经失败

